<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Trelliscope - Fixed</title>
    <link rel="stylesheet" href="https://unpkg.com/trelliscopejs-lib@0.7.16/dist/assets/index.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        #trelliscope-root {
            width: 100vw;
            height: 100vh;
        }
        #debug {
            position: fixed;
            top: 10px;
            right: 10px;
            background: black;
            color: lime;
            padding: 10px;
            font-family: monospace;
            font-size: 11px;
            max-width: 400px;
            z-index: 10000;
            border: 2px solid lime;
        }
    </style>
</head>
<body>
    <div id="debug">Loading...</div>
    <div id="trelliscope-root"></div>

    <script type="module">
        const debug = document.getElementById('debug');
        function log(msg) {
            console.log(msg);
            debug.innerHTML += msg + '<br>';
        }

        log('1. Loading displayInfo.json...');

        try {
            // First, fetch the display configuration
            const response = await fetch('./basic_viewer_demo/displayInfo.json');
            const displayInfo = await response.json();

            log('2. DisplayInfo loaded! Name: ' + displayInfo.name);

            log('3. Importing viewer module...');
            const module = await import('https://esm.sh/trelliscopejs-lib@0.7.16?bundle');

            log('4. Module imported!');

            const { Trelliscope, TrelliscopeApp } = module;

            // Try different initialization patterns
            log('5. Trying Trelliscope with displayInfo object...');

            try {
                // Pattern 1: Pass display info object directly
                const result = Trelliscope('trelliscope-root', displayInfo);
                log('6. Pattern 1 succeeded! Result: ' + typeof result);
            } catch (e1) {
                log('6. Pattern 1 failed: ' + e1.message);

                try {
                    // Pattern 2: Wrap in config object
                    log('7. Trying with wrapped config...');
                    const result = Trelliscope('trelliscope-root', {
                        id: 'trelliscope-root',
                        display: displayInfo,
                        displayInfo: displayInfo
                    });
                    log('8. Pattern 2 succeeded!');
                } catch (e2) {
                    log('8. Pattern 2 failed: ' + e2.message);

                    try {
                        // Pattern 3: Maybe it expects displayList (array)?
                        log('9. Trying with displayList array...');
                        const result = Trelliscope('trelliscope-root', {
                            displays: [displayInfo],
                            displayList: [displayInfo]
                        });
                        log('10. Pattern 3 succeeded!');
                    } catch (e3) {
                        log('10. Pattern 3 failed: ' + e3.message);

                        // Pattern 4: Check if TrelliscopeApp is the right one
                        log('11. All patterns failed. Checking TrelliscopeApp...');
                        log('12. TrelliscopeApp.toString(): ' + TrelliscopeApp.toString().substring(0, 300));
                    }
                }
            }

            // Check what got rendered after 1 second
            setTimeout(() => {
                const root = document.getElementById('trelliscope-root');
                log('13. Root has children: ' + (root.children.length > 0));
                if (root.children.length > 0) {
                    log('SUCCESS! Viewer rendered!');
                    debug.style.background = 'green';
                    setTimeout(() => debug.style.display = 'none', 3000);
                } else {
                    log('ERROR: Still nothing rendered');
                    debug.style.background = 'red';
                }
            }, 1000);

        } catch (error) {
            log('ERROR: ' + error.message);
            log('Stack: ' + error.stack);
            debug.style.background = 'red';
        }
    </script>
</body>
</html>
