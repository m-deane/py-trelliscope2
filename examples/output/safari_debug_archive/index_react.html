<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Trelliscope - React Render</title>
    <link rel="stylesheet" href="https://unpkg.com/trelliscopejs-lib@0.7.16/dist/assets/index.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        #trelliscope-root {
            width: 100vw;
            height: 100vh;
        }
        #debug {
            position: fixed;
            top: 10px;
            right: 10px;
            background: black;
            color: lime;
            padding: 10px;
            font-family: monospace;
            font-size: 11px;
            max-width: 400px;
            z-index: 10000;
            border: 2px solid lime;
        }
    </style>
</head>
<body>
    <div id="debug">Loading...</div>
    <div id="trelliscope-root"></div>

    <!-- Load React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>

    <script type="module">
        const debug = document.getElementById('debug');
        function log(msg) {
            console.log(msg);
            debug.innerHTML += msg + '<br>';
        }

        log('1. React loaded: ' + (typeof React !== 'undefined'));
        log('2. ReactDOM loaded: ' + (typeof ReactDOM !== 'undefined'));

        try {
            log('3. Loading displayInfo.json...');
            const response = await fetch('./basic_viewer_demo/displayInfo.json');
            const displayInfo = await response.json();

            log('4. DisplayInfo loaded! Name: ' + displayInfo.name);

            log('5. Importing viewer module...');
            const module = await import('https://esm.sh/trelliscopejs-lib@0.7.16?bundle');

            log('6. Module imported!');

            const { Trelliscope, TrelliscopeApp } = module;

            // Use TrelliscopeApp as a React component
            log('7. Rendering TrelliscopeApp with ReactDOM...');

            const rootElement = document.getElementById('trelliscope-root');

            // TrelliscopeApp expects: data, width, height, options
            const appProps = {
                data: displayInfo,
                width: window.innerWidth,
                height: window.innerHeight,
                options: {
                    spa: false
                }
            };

            log('8. Props: ' + JSON.stringify({
                dataName: displayInfo.name,
                width: appProps.width,
                height: appProps.height
            }));

            // Create React element and render
            const element = TrelliscopeApp(appProps);

            log('9. React element created: ' + (element !== null));

            // Use ReactDOM to render
            const root = ReactDOM.createRoot(rootElement);
            root.render(element);

            log('10. ReactDOM.render called!');

            // Check if it rendered
            setTimeout(() => {
                const children = rootElement.children.length;
                log('11. Root has ' + children + ' children');
                if (children > 0) {
                    log('SUCCESS! Viewer rendered!');
                    debug.style.background = 'green';
                    setTimeout(() => debug.style.display = 'none', 3000);
                } else {
                    log('ERROR: Still nothing rendered');
                    debug.style.background = 'red';
                }
            }, 1000);

        } catch (error) {
            log('ERROR: ' + error.message);
            log('Stack: ' + error.stack);
            debug.style.background = 'red';
        }
    </script>
</body>
</html>
