<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Trelliscope - With metaData.js</title>
    <link rel="stylesheet" href="https://unpkg.com/trelliscopejs-lib@0.7.16/dist/assets/index.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        #trelliscope-root {
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>
<body>
    <div id="trelliscope-root" class="trelliscope-not-spa"></div>

    <!-- Load metaData.js BEFORE initializing viewer -->
    <script src="./basic_viewer_demo/metaData.js"></script>

    <script type="module">
        console.log('=== WITH metaData.js ===');

        // Check if metaData loaded
        console.log('1. window.metaData type:', typeof window.metaData);
        console.log('2. window.metaData length:', window.metaData?.length);

        if (window.metaData && window.metaData.length > 0) {
            console.log('3. ✓ metaData loaded!', window.metaData.length, 'rows');
            console.log('   First row:', window.metaData[0]);
        } else {
            console.error('3. ✗ metaData NOT loaded!');
        }

        console.log('4. Loading viewer...');
        const module = await import('https://esm.sh/trelliscopejs-lib@0.7.16?bundle');
        const initFunc = window.trelliscopeApp || module.trelliscopeApp;

        console.log('5. Initializing viewer...');
        const result = initFunc('trelliscope-root', './basic_viewer_demo/displayInfo.json');
        console.log('6. Init result:', typeof result);

        // Check for panels after delay
        setTimeout(() => {
            const imgs = document.querySelectorAll('#trelliscope-root img');
            console.log(`7. After 3s - Images: ${imgs.length}`);

            if (imgs.length > 0) {
                console.log('✓✓✓ SUCCESS! Panels are rendering!');
                imgs.forEach((img, i) => {
                    console.log(`   Panel ${i}: ${img.src}`);
                });
            } else {
                console.log('Still no images');
                const text = document.body.textContent;
                if (text.includes(' of 20') || text.includes('20 of 20')) {
                    console.log('⚠ Viewer found 20 panels but images not rendering');
                } else {
                    console.log('❌ Viewer still shows 0 of 0');
                }
            }
        }, 3000);
    </script>
</body>
</html>
